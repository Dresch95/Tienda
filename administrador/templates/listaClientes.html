{% extends 'base.html' %}

{% block 'titulo' %}
Listado de Clientes
{% endblock %}

{% block 'contenido' %}
<table>
    <thead>
        <tr>
            <th>Nombre</th>
            <th>Email</th>
        </tr>
    </thead>
    <tbody>
        {% for c in clientes %}
        <tr>
            <td><a href="{% url 'detallesCliente' c.id %}">{{c.name}}</a></td>
            <td>{{c.email}}</td>
            <td><a href="{% url 'modificarClienteVista' c.id %}" class="botonEnlace Azul">Modificar</a></td>
            <td><a href="{% url 'borrarCliente' c.id %}" class="botonEnlace Rojo">Eliminar</a></td>
            {% if c.unable %}
            <td><button value="{{c.id}}" id="modificarEstadoCliente"
                    onclick="modificarEstadoDelCliente(event);" class="botonCambiarEstado botonHabilitar">Habilitar</button></td>
            {% else %}
            <td><button value="{{c.id}}" id="modificarEstadoCliente"
                    onclick="modificarEstadoDelCliente(event);"  class="botonCambiarEstado botonDeshabilitar">Deshabilitar</button></td>
            {% endif %}
        </tr>
        {% endfor %}
    </tbody>
</table>
<div class="crearBoton">
    <a href="{% url 'crearClienteVista' %}" class="botonEnlace Azul">Crear Cliente</a>
</div>
<script>
    function modificarEstadoDelCliente(event) {
        var boton = event.target;
        var id = boton.value;
        $.ajaxSetup({data: {csrfmiddlewaretoken: '{{ csrf_token }}' } });
        $.ajax({
            url: "{% url 'cambiarEstadoCliente' %}",
            type: 'POST',
            data: {'idCliente':id},
            dataType: 'json'
        }).done(function (response) {
            if (response['estado_cambiado']) {
                boton.textContent = "Habilitar";
                boton.setAttribute("class","botonCambiarEstadoCliente botonHabilitar");
            } else {
                boton.textContent = "Deshabilitar";
                boton.setAttribute("class","botonCambiarEstadoCliente botonDeshabilitar");
            }
        }).fail(function () {
                console.log("failed");
            })
    }
</script>
{% endblock %}